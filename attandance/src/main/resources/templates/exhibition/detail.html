<!DOCTYPE html>
<html lang="en" xmlns:th=" http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Vystoupení Detail</title>
</head>
<body>
<div th:include="layout.html"></div>
<div class="page-content">
    <div>
        <!--TODO Action info-->
        <div id="jsGrid"></div>
    </div>
    <div>
        <!--TODO Chooser-->
        <div>
            <button type="button2" class="basic-btn" id="showUsers">button2</button>
            <div class="form-group" id="userSelect">
                <label for="user">Uživatel:</label>
                <select class="custom-select" id="user">
                </select>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script>
    $(document).ready(function () {
        $("#userSelect").hide();
        let hide = true;
        $.ajax({
            method: "GET",
            url: "/api/v1/user",
            success: function (items) {
                console.log(items);
                items.forEach(function (user) {
                    $('#user').append(new Option(user.person.firstname + " " + user.person.lastname, user.userid))
                })
            }
        });

        let data = [];
        $.ajax({
            url: "/api/v1/user/action/" + "[[${actionid}]]",
            method: "GET",
            success: function (items) {
                for (let i = 0; i < items.length; i++) {
                    console.log(items[i]);
                    let item =
                        {
                            "firstname": "<a href=/profil/user/" + items[i].userid + ">" + items[i].person.firstname + "",
                            "lastname": items[i].person.lastname,
                            "username": items[i].username,
                            "role": items[i].person.role.name
                        };
                    data.push(item);
                }
                renderJsGrid(data);
            }
        });




        $("#showUsers").on("click", function () {
            hide ? $("#userSelect").show() : $("#userSelect").hide();
            hide = !hide;
        });
    });


    $("#user").on('change', function () {
            $.ajax({
                method: "POST",
                url: "/api/v1/useraction",
                dataType: "json",
                contentType: "application/json",
                data: JSON.stringify({
                    "userid": $("#user").val(),
                    "actionid": "[[${actionid}]]"
                }),
                success: function () {
                    location.reload();
                }
            })
        });

    function renderJsGrid(data) {
        $("#jsGrid").jsGrid({
            width: "100%",
            height: "100%",

            searching: true,
            sorting: true,

            data: data,

            fields: [
                { name: "firstname", type: "text", title: "Jméno", width: 60 },
                { name: "lastname", type: "text", title: "Příjmení", width: 60 },
                { name: "username", type: "text", title: "Uživatelské jméno", width: 60 },
                { name: "role", type: "text", title: "Typ", width: 30 }
            ]
        });
    }

</script>
